---
title: 「急げば漕げマップ」での公共交通データの活用
author: 西片トコトコ探索会
title-slide-attributes:
    data-background-image: img/backimg.png
    data-background-size: cover
format: 
  revealjs:
    theme: [white, custom.scss]
    slide-number: c/t
    smaller: true
    width: 1200
---

## 自己紹介 | 西片トコトコ探索会

![公共交通オープンデータチャレンジ2024表彰式にて、坂村会長と。（残念ながら1名欠席）](img/group_pic.jpg)

都市計画を専門とする4名で構成。都市を楽しむ視点を何とかデータを使って提供できないかと考えた末、従来の乗換案内ではヒットしないシェアサイクルを鉄道利用と組み合わせたルートを提示する「急がば漕げマップ」を開発。

## 「急げば漕げマップ」とは

**鉄道を利用するより自転車を漕ぐほうが良いルート**を表示するウェブアプリ。

<br>

:::: {.columns}

::: {.column width="50%"}

### 到達時間マップ

![到達時間マップでは、ある駅から他の駅への到達時間および移動経路を提示。](img/ogp_map.png)

それぞれの利用者からみた視点を念頭に、

- 指定した出発駅から他の駅への到達時間を表示
- 到着駅をクリックすると、その駅への「最適経路」を表示

:::

::: {.column width="50%"}

### サイクルポテンシャルマップ

![サイクルポテンシャルマップは、サイクリング需要が高いと考えられる区間を表示。](img/ogp_potential.png)

自治体担当者やモビリティ事業者を念頭に、自転車と鉄道を組み合わせた利用が行われるシナリオにおいて、

- どの駅同士（リンク）でのサイクリング需要が高いのか表示（＝自転車レーン等の利用を想定）
- どの駅（ノード）で自転車の利用が多いかを表示（＝シェアサイクルのドックがどの程度必要か）

:::

::::

## 背景

> 鉄道網はかなり発達してきているが、乗換検索には出てこない**アウトローな乗り換え**によってもっと便利になるのでは？
> 
> シェアサイクルの充実もあり、そこに組み合わせのポテンシャルがあるのでは？

<br>

### アウトローな乗り換えの例

:::: {.columns}

::: {.column width="50%"}

![吉祥寺駅から田無駅の例。鉄道だけであれば都心（この場合は高田馬場駅）まで出ないといけないが、自転車でかなりのショートカットが可能。](img/ex1.png)

乗換駅まで大きく迂回しなければならないところを、自転車によってショートカットするパターン。放射状に伸びている首都圏の鉄道網の性質上、郊外部でありそう。

:::

::: {.column width="50%"}

![高島平駅から京成高砂駅の例。都営三田線と京成線は直接交わらないため、鉄道で行くためには巣鴨駅と日暮里駅で2回の乗り換えが必要となるが、自転車で白山駅→日暮里駅を自転車で移動すれば1回で済む。](img/ex2.png)

目的地の路線に直接乗り換えることができないため、複数回の乗り換えを強いられる場合。自転車で繋げば乗り換え回数が削減できそう。

:::

::::

## ネットワークの構築

:::: {.columns}

::: {.column width="50%"}

![構築したネットワーク図。出発から到着までの移動を要素ごとに分解し、それぞれに重み付けしたネットワークを構築。](img/graph_explain.png)

:::

::: {.column width="50%"}

公開されている鉄道事業者の時刻表データをもとに、ネットワークを構築。

- 公開されたデータをもとに、平均の所要時間や待ち時間を用いてネットワークのリンクを構築
  - 例：10分間隔の場合、平均待ち時間5分
  - 種別・方面ごとに整理したほか、鉄道乗降時・乗換時・直通運転など要素に分解し所要時間に応じて重み付け
  - 乗り換え時間は、大都市交通センサスのデータを使用
- 自転車による駅間の移動についても、距離をもとに移動時間を推定しリンクをつなぐ

その後、「大都市交通センサス」のデータをもとに最短経路検索を行い、サイクルポテンシャル（交通量）を推定。

::: {.callout-note title="平均所要時間を用いることについて"}
所要時間の誤差の大きい自転車による移動を主眼においているため、リアルタイムの検索によるメリットが少ない。

列車単位だとネットワークのデータが膨れ上がり技術的難易度が上がるが、駅数のオーダーならなんとかなりそう。

結果として、ゴリゴリ最適化しなくても比較的サクサク動くアプリ構築に成功。（最短経路検索はナイーブなダイクストラ法を使用！）
:::

> 仕組みの詳細については[ウェブアプリ上](https://nishikata-tokotoko.github.io/cycle-shortcut-map/explained.html)で解説しています。

:::

::::

---

### 使用データ

| データ | 使用目的 | 出典 |
|---|---|---|
| 鉄道運行関連データ | グラフの構築・計算 | [公共交通オープンデータセンター](https://ckan.odpt.org/dataset) |
| 鉄道路線データ | 地図上での表示・未提供データ補完 | [国土数値情報 鉄道時系列データ](https://nlftp.mlit.go.jp/ksj/gml/datalist/KsjTmplt-N05-2023.html) |
| シェアサイクル関連GBFSデータ | 施設整備状況・リアルタイム状況把握 | [公共交通オープンデータセンター](https://ckan.odpt.org/dataset) |
| 駅間流動データ | サイクルポテンシャルの計算 | [大都市交通センサス（令和3年度調査）](https://www.mlit.go.jp/sogoseisaku/transport/sosei_transport_tk_000007.html) |

: 「急がば漕げマップ」にて使用しているデータの一覧

これらのデータをもとにして、首都圏の鉄道網を表現する**多層ネットワーク**を構築。

<br>

### 使用したツール

:::: {.columns}

::: {.column width="50%"}

データの取得・クリーニング・分析：**Python**

- [NetworkX](https://networkx.org/): ネットワーク構築・分析
- [Pandas](https://pandas.pydata.org/) / [Geopandas](https://geopandas.org/en/stable/): テーブルデータ・GISデータ処理
- [H3](https://h3geo.org/): 空間インデックス：演算の軽量化に活用

:::

::: {.column width="50%"}

ウェブアプリの構築：**JavaScript**

- [MapLibre GL JS](https://maplibre.org/maplibre-gl-js/docs/): オンライン地図の制作
- [H3](https://h3geo.org/): 上記同様（H3はC/Javaなど多言語でも使用可能）
- [D3.js](https://d3js.org/): グラフ等の表示

::: {.callout-note}
ウェブサイトのホストはGitHub Pagesを使用。
:::

:::

::::

::: aside
ソースコードは[GitHubのレポジトリ](https://github.com/nishikata-tokotoko/cycle-shortcut-map)にて公開中
:::

## 「最適経路」とは？

:::: {.columns}

::: {.column width="60%"}

自転車と鉄道の組み合わせのため、取りうる経路は多く存在。どのような経路を「最適」とするかは人によって・状況によって異なる。

- 少しの移動のためにサイクルポートを見つけて、借りて、返却するのは面倒 → **最小移動距離**
- いくら速く移動できるとはいえ、長距離の自転車移動は限界がある → **最大移動距離**
- 自転車に乗ることは**楽しい・健康に良い**などのメリットがあるため、多少の時間追加を許してでも自転車に乗りたい！ → **許容追加時間**
- 登録していないシェアサイクルサービスは使えない
- 逆に、折りたたみ自転車なので関係なく移動できる

> これらの情報をもとにある程度経路検索結果に影響を与えられるよう、多くの設定項目を用意。

:::

::: {.column width="40%"}

![どのような経路を最適とするか、多くの設定項目を用意](img/settings.png)

:::

::::

## 見えてきたもの

:::: {.columns}

::: {.column width="50%"}

![所要時間が短縮できる駅にはいくつかパターンがある（例：丸ノ内線支線方南町駅](img/honancho.png)

![鉄道ネットワークのつながりが不便なエリアが浮かび上がってくる（中央線・西武線エリア）](img/kichi_map.png)

:::

::: {.column width="50%"}

![新線計画（この図ではエイトライナー）とサイクルポテンシャルには関連があるように見える！](img/8liner.png)

![人気があるバス路線（例えば都01系統）とも関連がありそう。](img/T01_map.png)

:::

::::

## いろいろな取り組み

> 「急げば漕げマップ」を楽しんでほしい + まちづくり的な面白さを発信したい

ということで、OSSの精神にのっとり、なるべく「手の内を明かす」ことを意識。

<br>

:::: {.columns}
::: {.column width="33%"}

### アプリ上の情報の充実

ウェブアプリ上において、しくみの解説や見えてきたことのヒントを掲載。楽しむための工夫を用意。

![ウェブアプリ上で掲載している説明の例。これはH3グリッドについて。](img/h3_grid.png)

:::

::: {.column width="34%"}

### 制作者ブログの執筆

制作者ブログにて、アプリには書ききれなかったこぼれ話や自分たちが使ううちに気付いた点を共有しています。

![ブログのスクリーンショット](img/blog.png)

:::

::: {.column width="33%"}

### 研究報告の発表

都市計画学会が発行する「都市計画報告集」に研究報告を投稿。11月の全国大会でも口頭発表を予定しています。

![研究報告](img/paper.jpg)

:::

::::

## まとめ

> 公共交通オープンデータチャレンジで公開されているデータから、複数の鉄道事業者、また様々な交通モードのデータが利用可能。
>
> データの組み合わせによって、都市や交通に関する新しい発見が産まれそう。
>
> （非プログラマのチームとして最優秀賞を受賞して）技術の高度さだけでなく、着眼点の面白さで勝負できるのも魅力。ぜひまちづくりに関心がある人にも積極的に遊んでほしい

<br><br>

### Links

- [「急がば漕げマップ」](https://nishikata-tokotoko.github.io/cycle-shortcut-map/index.html)
- [GitHubレポジトリ](https://github.com/nishikata-tokotoko/cycle-shortcut-map)
- [西片トコトコ探索会note（制作者ブログ）](https://note.com/nishitoko)
- [「都市計画報告集」掲載論文](https://doi.org/10.11361/reportscpij.24.1_19)
